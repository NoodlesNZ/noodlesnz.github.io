"use strict";(self.webpackChunknoodles=self.webpackChunknoodles||[]).push([[3236],{6896:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>u,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>a,toc:()=>h});var o=n(5893),i=n(1151);const s={slug:"ipv6-workaround-for-unifi-usg-on-2-degrees-ufb",title:"ipv6 workaround for Unifi USG on 2 Degrees UFB"},r=void 0,a={permalink:"/blog/ipv6-workaround-for-unifi-usg-on-2-degrees-ufb",source:"@site/blog/2018-09-20-ipv6-workaround-for-unifi-usg-on-2-degrees-ufb.mdx",title:"ipv6 workaround for Unifi USG on 2 Degrees UFB",description:"I had an issue where our USG Pro was not getting ipv6 from 2 Degrees UFB after upgrading our Controller to 5.8. After a lot of messing around with this, I found a workaround originally posted here//community.ubnt.com/t5/UniFi-Routing-Switching/USG-DHCPv6-PD-bug-when-using-PPPoE/td-p/2487710. Digging into the dhcpv6-pd logs shows this: Dumping out the config I saw that I had two [&hellip;]",date:"2018-09-20T00:00:00.000Z",formattedDate:"September 20, 2018",tags:[],readingTime:1.17,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"ipv6-workaround-for-unifi-usg-on-2-degrees-ufb",title:"ipv6 workaround for Unifi USG on 2 Degrees UFB"},unlisted:!1,prevItem:{title:"Running Akamai Sandbox in Docker with HTTPS",permalink:"/blog/running-akamai-sandbox-in-docker-with-https"},nextItem:{title:"Speed up Jenkins phpcs (PHP CodeSniffer)",permalink:"/blog/speed-up-jenkins-phpcs-php-codesniffer"}},u={authorsImageUrls:[]},h=[];function d(t){const e={a:"a",p:"p",...(0,i.a)(),...t.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("p",{children:["I had an issue where our USG Pro was not getting ipv6 from 2 Degrees UFB after upgrading our Controller to 5.8. After a lot of messing around with this, I found a workaround originally posted here: ",(0,o.jsx)(e.a,{href:"https://community.ubnt.com/t5/UniFi-Routing-Switching/USG-DHCPv6-PD-bug-when-using-PPPoE/td-p/2487710",children:"https://community.ubnt.com/t5/UniFi-Routing-Switching/USG-DHCPv6-PD-bug-when-using-PPPoE/td-p/2487710"}),". Digging into the dhcpv6-pd logs shows this: Dumping out the config I saw that I had two [\u2026]"]}),"\n",(0,o.jsxs)(e.p,{children:["I had an issue where our USG Pro was not getting ipv6 from 2 Degrees UFB after upgrading our Controller to 5.8. After a lot of messing around with this, I found a workaround originally posted here: ",(0,o.jsx)("a",{href:"https://community.ubnt.com/t5/UniFi-Routing-Switching/USG-DHCPv6-PD-bug-when-using-PPPoE/td-p/2487710",target:"_blank",rel:"noopener",children:(0,o.jsx)(e.a,{href:"https://community.ubnt.com/t5/UniFi-Routing-Switching/USG-DHCPv6-PD-bug-when-using-PPPoE/td-p/2487710",children:"https://community.ubnt.com/t5/UniFi-Routing-Switching/USG-DHCPv6-PD-bug-when-using-PPPoE/td-p/2487710"})}),"."]}),"\n",(0,o.jsx)(e.p,{children:"Digging into the dhcpv6-pd logs shows this:"}),"\n",(0,o.jsx)("script",{src:"https://gist.github.com/NoodlesNZ/f8ba0f83c0210e75a5587da9d4e2a606.js?file=gistfile1.txt"}),"\n",(0,o.jsx)(e.p,{children:"Dumping out the config I saw that I had two dhcpv6-pd blocks, one under interface eth2 vif 10 and the other under interface eth2 vif 10 pppoe 2 (where it should be):"}),"\n",(0,o.jsx)("script",{src:"https://gist.github.com/NoodlesNZ/f8ba0f83c0210e75a5587da9d4e2a606.js?file=gistfile2.txt"}),"\n",(0,o.jsx)(e.p,{children:"It was possible to temporarily fix this issue by removing the first block:"}),"\n",(0,o.jsx)("script",{src:"https://gist.github.com/NoodlesNZ/f8ba0f83c0210e75a5587da9d4e2a606.js?file=gistfile3.txt"}),"\n",(0,o.jsx)(e.p,{children:"This allowed our USG to get ipv6 from our ISP and now all the clients on the network also got ipv6."}),"\n",(0,o.jsx)(e.p,{children:"To make this more permanent I had to add this file on the USG under /config/scripts/post-config.d/dhcp.sh"}),"\n",(0,o.jsx)("script",{src:"https://gist.github.com/NoodlesNZ/f8ba0f83c0210e75a5587da9d4e2a606.js?file=dhcp.sh"}),"\n",(0,o.jsx)(e.p,{children:"To run this script, I added the following on the Controller in /usr/lib/unifi/data/sites/default/config.gateway.json:"}),"\n",(0,o.jsx)("script",{src:"https://gist.github.com/NoodlesNZ/f8ba0f83c0210e75a5587da9d4e2a606.js?file=config.gateway.json"}),"\n",(0,o.jsx)(e.p,{children:"This runs the dhcp.sh script 2 minutes after provisioning and then the script removes the scheduled task (as it only needs to run once)."})]})}function c(t={}){const{wrapper:e}={...(0,i.a)(),...t.components};return e?(0,o.jsx)(e,{...t,children:(0,o.jsx)(d,{...t})}):d(t)}},1151:(t,e,n)=>{n.d(e,{Z:()=>a,a:()=>r});var o=n(7294);const i={},s=o.createContext(i);function r(t){const e=o.useContext(s);return o.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function a(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:r(t.components),o.createElement(s.Provider,{value:e},t.children)}}}]);